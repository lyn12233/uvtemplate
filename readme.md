# UVProject Template

- template targeting board stm32f10x generated by stm32cubemx 
- testing on uvhelper: to gen stub file for hinting

> below is a description on stm32f103xe dev

## basic knowledge

### nomenclature

- AHB: advanced high-performance bus
- APB: advanced pci bridge
- CMSIS: common microcontroller software interface standard
- GPIO: general purpose IO
- HAL: hardware abstract level
- HSE: high-speed external crystal
- NVIC: embedded vector interrupt register
- PLL: phase lock loop
- RCC: reset and clock control
- UEV: update event
- UIF: update interrupt flag


### hardware info

cortex-m3 core component:
    1. cm3 core(cpu, based on armv7 core)
    2. NVIC: embedded vector interrupt controller
    3. systick: 24bit counter
    4. MPU: memory protection unit
    5. bus matrix?

arm32 cpu registers:
    1. r0-r12
    2. r13: MSP
    3. r14-r15
    4. xPSR state register
    5. PRIMASK, FAULTMASK, BASEPRI: interrupt registers
    6. CONTROL

stm32 pins:
 - power
 - oscillator
 - reset/download/boot
 - gpio

cm3 structure:
    1. cpu->code bus->flash/sram
    2. cpu->sysbus->AHB(advanced high-performance bus?)->RAM
    3. cpu->sysbus->APB(advanced pci bridge)->IO/UART

storage:

stm32 naming:

- F: general purpose
- 101/102/103/105: basic/usb/enhanced/connected
- T/C/R/V/Z: 36pin/48pin/64pin/100pin/144pin
- 4/6/8/B/C/D/E: 16K/32K/64K/128K/256K/384K/512K flash
- ..

### GPIO

#### mode
- in floating
- input pull up (IPU)
- input pull down (IPD)
- analog in (AIN)
- (out / alternate function(AF)) (open drain(OD) / pull-push(PP))
#### speed
in stm32: 2M(serial), 10M(IIC), 50M(SPI)
#### types and functions:

GPIO_InitTypeDef, GPIO_PIN_x, GPIO_MODE_x, GPIO_SPEED_x, __HAL_RCC_GPIOx_CLK_ENABLE HAL_GPIO_Init(), HAL_GPIO_(Write/Toggle/Read)Pin,...

> to lit LED, scheme shows that LED0--PB5 means GPIOB pin5

### timers
#### common timer modes:
- regular
- pwm output
- input mode
#### timers in stm
- TIM6-7(basic)
- TIM2-5(general)
- TIM1,TIM8(advanced)
> need more info

#### timer registers
- xxx_CRx(control reg)
- xxx_DIER(DMA interrupt enabler reg)
- xxx_SR(state reg)
- xxx_EGR(event generator reg)
- xxx_CNT
- xxx_ARR(auto reload reg)
- xxx_PSC(prescaler)
for general regs:
- xxx_CCR(capture-compare reg)
#### timer clock sources
CK_INT(internal), TIx(toggle input), ETR(external toggle), ITRx(internal toggle)
#### timer behavior

## description of file layout:

- ./core: startup entry, main entry, and system ctors
  - inc
  - src
    - main.c: main loop
    - startup_< stm version >.s: init stack and instruction pointers,...

- ./drivers/CMSIS: software interface
  - device/st/stm32f1xx/include
    - stmxxx.h: defines IRQn names, peripheral device structs, etc
    - system_stmxxx.h: exports core_clock,AHB/APB table structs; system_init() and system_clock_update() functions.
  - include
    - cmsis_< compiler >.h: for compiler compatibility
    - core_cmx.h: defines PSR types, NVIC struct,  NVIC access functions, etc (unused?)

- ./drivers/STM32F1xx_HAL_Driver: HAL lib
  - inc
  - src

### include hierachy